{"ast":null,"code":"import{store}from'../../../../store/store.js';var SCROLL_BAR_ENDPOINT_DELTA=22*4;var curRow=1;var curCol=1;var lowestPixel;var rightMostPixel;var pseudoMarginTops;function applyScrollSnapHandlers(){updateScrollDimensions();document.querySelector('#tableEntryCellsWindow').onwheel=function(){return false;};document.querySelector('#tableEntryCellsWindow').addEventListener('scroll',scrollHandler);document.querySelector('#tableEntryCells').addEventListener('wheel',wheelHandler);window.history.scrollRestoration='manual';// scroll should reset on page reload\n}function updateScrollDimensions(){var tableEntryCellsWindow=document.querySelector('#tableEntryCellsWindow');var tableEntryCells=document.querySelector('#tableEntryCells');var parentDivHeight=parseInt(tableEntryCellsWindow.offsetHeight,10);var parentDivWidth=parseInt(tableEntryCellsWindow.offsetWidth,10);var tableHeight=parseInt(tableEntryCells.scrollHeight,10);var tableWidth=parseInt(tableEntryCells.scrollWidth,10);var totalRows=store.getState().tableDimensions.totalRows;pseudoMarginTops=[0];for(var i=1;i<totalRows;++i){pseudoMarginTops.push(parseInt(pseudoMarginTops[i-1],10)+parseInt(document.querySelector(\"#row\".concat(i)).style.height,10));}lowestPixel=tableHeight-parentDivHeight+23;rightMostPixel=tableWidth-parentDivWidth+50-18-18+4;//console.log(lowestPixel + ' ' + rightMostPixel);\n}function scrollHandler(){var scrollBarLayer=document.querySelector('#tableEntryCellsWindow');var newPosX=scrollBarLayer.scrollLeft;var newPosY=scrollBarLayer.scrollTop;while(newPosY>pseudoMarginTops[curRow])++curRow;while(newPosY<pseudoMarginTops[curRow-1])--curRow;if(newPosY>lowestPixel)newPosY=lowestPixel;else newPosY=pseudoMarginTops[curRow-1];while(newPosX>getMarginLeft(curCol+1))++curCol;while(newPosX<getMarginLeft(curCol))--curCol;// console.log(newPosX + ' ' + rightMostPixel + ' ' + SCROLL_BAR_ENDPOINT_DELTA);\nif(newPosX>rightMostPixel-SCROLL_BAR_ENDPOINT_DELTA)newPosX=rightMostPixel;else newPosX=getMarginLeft(curCol);//console.log('Scroll');\n//console.log('Scroll > curRow: ' + curRow + ' curCol: ' + curCol + ' newPosX: ' + newPosX + ' newPosY: ' + newPosY);\nupdateTablePosition(newPosX,newPosY);}function getMarginLeft(curCol){var totalCols=store.getState().tableDimensions.totalCols;return parseInt(document.querySelector(\".row1.col\".concat(curCol<totalCols?curCol:totalCols)).style.marginLeft,10);}var scrollTimeout=null;function wheelHandler(event){var totalRows=store.getState().tableDimensions.totalRows;var totalCols=store.getState().tableDimensions.totalCols;var newPosX;var newPosY;if(event.deltaY>0){if(event.shiftKey){var nextColCell=document.querySelector(\".row\".concat(curRow,\".col\").concat(curCol<16?curCol+1:16));newPosX=parseInt(nextColCell.style.marginLeft,10);if(newPosX>rightMostPixel-SCROLL_BAR_ENDPOINT_DELTA){newPosX=rightMostPixel;}else if(curCol<totalCols)++curCol;}else{newPosY=pseudoMarginTops[curRow<totalRows?curRow:curRow-1];if(newPosY>lowestPixel)newPosY=lowestPixel;else if(curRow<totalRows)++curRow;}}else{if(event.shiftKey){var prevColCell=document.querySelector(\".row\".concat(curRow,\".col\").concat(curCol>1?curCol-1:1));newPosX=parseInt(prevColCell.style.marginLeft,10);if(newPosX<SCROLL_BAR_ENDPOINT_DELTA)newPosX=0;else if(curCol>1)--curCol;}else{newPosY=pseudoMarginTops[curRow>1?curRow-2:curRow-1];if(newPosY>lowestPixel)newPosY=lowestPixel;else if(curRow>1)--curRow;}}// Since we're already scrolling via wheel event, we wrap tableEntryCellsWindow with logic that cancels scroll event\ndocument.querySelector('#tableEntryCellsWindow').removeEventListener('scroll',scrollHandler);document.querySelector('#tableEntryCellsWindow').scroll({top:newPosY,left:newPosX,behavior:'auto'});if(scrollTimeout)clearTimeout(scrollTimeout);scrollTimeout=setTimeout(function(){document.querySelector('#tableEntryCellsWindow').addEventListener('scroll',scrollHandler);},500);console.log('Wheel');//console.log('Wheel > curRow: ' + curRow + ' curCol: ' + curCol + ' newPosX: ' + newPosX + ' newPosY: ' + newPosY);\nupdateTablePosition(newPosX,newPosY);}function updateTablePosition(newPosX,newPosY){document.querySelector('#axisY').style.marginTop=22-newPosY+'px';document.querySelector('#axisX').style.marginLeft=50-newPosX+'px';document.querySelector('#tableEntryCells').scroll({top:newPosY,left:newPosX,behavior:'auto'});}export{applyScrollSnapHandlers,updateScrollDimensions};","map":{"version":3,"names":["store","SCROLL_BAR_ENDPOINT_DELTA","curRow","curCol","lowestPixel","rightMostPixel","pseudoMarginTops","applyScrollSnapHandlers","updateScrollDimensions","document","querySelector","onwheel","addEventListener","scrollHandler","wheelHandler","window","history","scrollRestoration","tableEntryCellsWindow","tableEntryCells","parentDivHeight","parseInt","offsetHeight","parentDivWidth","offsetWidth","tableHeight","scrollHeight","tableWidth","scrollWidth","totalRows","getState","tableDimensions","i","push","style","height","scrollBarLayer","newPosX","scrollLeft","newPosY","scrollTop","getMarginLeft","updateTablePosition","totalCols","marginLeft","scrollTimeout","event","deltaY","shiftKey","nextColCell","prevColCell","removeEventListener","scroll","top","left","behavior","clearTimeout","setTimeout","console","log","marginTop"],"sources":["C:/Users/rband/Desktop/SpreadsheetPanel/client/src/components/TablePanel/handlers/scrollSnapHandler/scrollSnapHandler.js"],"sourcesContent":["import { store } from '../../../../store/store.js';\r\n\r\nconst SCROLL_BAR_ENDPOINT_DELTA = 22 * 4;\r\nlet curRow = 1;\r\nlet curCol = 1;\r\nlet lowestPixel;\r\nlet rightMostPixel;\r\nlet pseudoMarginTops;\r\n\r\nfunction applyScrollSnapHandlers() {\r\n    updateScrollDimensions();\r\n    document.querySelector('#tableEntryCellsWindow').onwheel = function () { return false; }\r\n    document.querySelector('#tableEntryCellsWindow').addEventListener('scroll', scrollHandler);\r\n    document.querySelector('#tableEntryCells').addEventListener('wheel', wheelHandler);\r\n    window.history.scrollRestoration = 'manual'; // scroll should reset on page reload\r\n}\r\n\r\nfunction updateScrollDimensions() {\r\n    let tableEntryCellsWindow = document.querySelector('#tableEntryCellsWindow');\r\n    let tableEntryCells = document.querySelector('#tableEntryCells');\r\n\r\n    let parentDivHeight = parseInt(tableEntryCellsWindow.offsetHeight, 10);\r\n    let parentDivWidth = parseInt(tableEntryCellsWindow.offsetWidth, 10);\r\n    let tableHeight = parseInt(tableEntryCells.scrollHeight, 10);\r\n    let tableWidth = parseInt(tableEntryCells.scrollWidth, 10);\r\n    let totalRows = store.getState().tableDimensions.totalRows;\r\n    pseudoMarginTops = [0];\r\n    for (let i = 1; i < totalRows; ++i) {\r\n        pseudoMarginTops.push(parseInt(pseudoMarginTops[i - 1], 10) + parseInt(document.querySelector(`#row${i}`).style.height, 10));\r\n    }\r\n\r\n    lowestPixel = tableHeight - parentDivHeight + 23;\r\n    rightMostPixel = tableWidth - parentDivWidth + 50 - 18 - 18 + 4;\r\n    //console.log(lowestPixel + ' ' + rightMostPixel);\r\n}\r\n\r\nfunction scrollHandler() {\r\n    let scrollBarLayer = document.querySelector('#tableEntryCellsWindow');\r\n    let newPosX = scrollBarLayer.scrollLeft;\r\n    let newPosY = scrollBarLayer.scrollTop;\r\n\r\n    while (newPosY > pseudoMarginTops[curRow]) ++curRow;\r\n    while (newPosY < pseudoMarginTops[curRow - 1]) --curRow;\r\n\r\n    if (newPosY > lowestPixel) newPosY = lowestPixel;\r\n    else newPosY = pseudoMarginTops[curRow - 1];\r\n\r\n    while (newPosX > getMarginLeft(curCol + 1)) ++curCol;\r\n    while (newPosX < getMarginLeft(curCol)) --curCol;\r\n\r\n    // console.log(newPosX + ' ' + rightMostPixel + ' ' + SCROLL_BAR_ENDPOINT_DELTA);\r\n    if (newPosX > rightMostPixel - SCROLL_BAR_ENDPOINT_DELTA) newPosX = rightMostPixel;\r\n    else newPosX = getMarginLeft(curCol);\r\n\r\n    //console.log('Scroll');\r\n    //console.log('Scroll > curRow: ' + curRow + ' curCol: ' + curCol + ' newPosX: ' + newPosX + ' newPosY: ' + newPosY);\r\n    updateTablePosition(newPosX, newPosY);\r\n}\r\n\r\nfunction getMarginLeft(curCol) {\r\n    let totalCols = store.getState().tableDimensions.totalCols;\r\n    return parseInt(document.querySelector(`.row1.col${curCol < totalCols ? curCol : totalCols}`).style.marginLeft, 10);\r\n}\r\n\r\nlet scrollTimeout = null;\r\nfunction wheelHandler(event) {\r\n    let totalRows = store.getState().tableDimensions.totalRows;\r\n    let totalCols = store.getState().tableDimensions.totalCols;\r\n    let newPosX;\r\n    let newPosY;\r\n\r\n    if (event.deltaY > 0) {\r\n        if (event.shiftKey) {\r\n            let nextColCell = document.querySelector(`.row${curRow}.col${curCol < 16 ? curCol + 1 : 16}`);\r\n            newPosX = parseInt(nextColCell.style.marginLeft, 10);\r\n            if (newPosX > rightMostPixel - SCROLL_BAR_ENDPOINT_DELTA) {\r\n                newPosX = rightMostPixel;\r\n            }\r\n            else if (curCol < totalCols) ++curCol;\r\n        } else {\r\n            newPosY = pseudoMarginTops[curRow < totalRows ? curRow : curRow - 1];\r\n            if (newPosY > lowestPixel) newPosY = lowestPixel;\r\n            else if (curRow < totalRows) ++curRow;\r\n        }\r\n    } else {\r\n        if (event.shiftKey) {\r\n            let prevColCell = document.querySelector(`.row${curRow}.col${curCol > 1 ? curCol - 1 : 1}`);\r\n            newPosX = parseInt(prevColCell.style.marginLeft, 10);\r\n            if (newPosX < SCROLL_BAR_ENDPOINT_DELTA) newPosX = 0;\r\n            else if (curCol > 1) --curCol;\r\n        } else {\r\n            newPosY = pseudoMarginTops[curRow > 1 ? curRow - 2 : curRow - 1];\r\n            if (newPosY > lowestPixel) newPosY = lowestPixel;\r\n            else if (curRow > 1) --curRow;\r\n        }\r\n    }\r\n\r\n    // Since we're already scrolling via wheel event, we wrap tableEntryCellsWindow with logic that cancels scroll event\r\n    document.querySelector('#tableEntryCellsWindow').removeEventListener('scroll', scrollHandler);\r\n    document.querySelector('#tableEntryCellsWindow').scroll({\r\n        top: newPosY,\r\n        left: newPosX,\r\n        behavior: 'auto'\r\n    });\r\n    if (scrollTimeout) clearTimeout(scrollTimeout);\r\n    scrollTimeout = setTimeout(() => {\r\n        document.querySelector('#tableEntryCellsWindow').addEventListener('scroll', scrollHandler);\r\n    }, 500);\r\n\r\n    console.log('Wheel');\r\n    //console.log('Wheel > curRow: ' + curRow + ' curCol: ' + curCol + ' newPosX: ' + newPosX + ' newPosY: ' + newPosY);\r\n    updateTablePosition(newPosX, newPosY);\r\n}\r\n\r\nfunction updateTablePosition(newPosX, newPosY) {\r\n    document.querySelector('#axisY').style.marginTop = 22 - newPosY + 'px';\r\n    document.querySelector('#axisX').style.marginLeft = 50 - newPosX  + 'px';\r\n    document.querySelector('#tableEntryCells').scroll({\r\n        top: newPosY,\r\n        left: newPosX,\r\n        behavior: 'auto'\r\n    });\r\n}\r\n\r\nexport { applyScrollSnapHandlers, updateScrollDimensions };"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}